<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APK Dropzone</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background: #0d1117; color: #c9d1d9; }
        .container { background: #161b22; padding: 20px; border-radius: 15px; border: 1px solid #30363d; }
        h2 { text-align: center; color: #58a6ff; }

        /* Buttons & Inputs */
        input { width: 100%; padding: 12px; margin-bottom: 10px; background: #0d1117; border: 1px solid #30363d; color: white; border-radius: 6px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .btn-upload { background: #238636; color: white; margin-bottom: 15px; }
        .btn-delete { background: #da3633; color: white; width: auto; padding: 4px 10px; font-size: 0.8em; margin-left: 10px; }
        .btn-refresh { background: #1f6feb; color: white; margin-bottom: 10px; }
        
        /* Secret Login Area */
        #adminLogin { display: none; margin-top: 20px; border-top: 1px solid #30363d; padding-top: 20px; }
        .secret-btn { background: none; border: none; color: #30363d; font-size: 1.2em; cursor: pointer; float: right; }
        .secret-btn:hover { color: #58a6ff; }

        /* File List */
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #21262d; margin-bottom: 8px; border-radius: 8px; border: 1px solid #30363d; }
        .file-name { color: #58a6ff; text-decoration: none; font-weight: bold; word-break: break-all; }
        .admin-controls { display: none; } /* Hidden for guests */
    </style>
</head>
<body>

<div class="container">
    <h2>üöÄ Shared Files</h2>

    <div id="uploaderSection" class="admin-controls">
        <input type="file" id="fileInput">
        <button class="btn-upload" onclick="uploadFile()">Upload New File</button>
        <p id="uploadStatus" style="font-size:0.9em; text-align:center;"></p>
        <hr style="border-color: #30363d;">
    </div>

    <button class="btn-refresh" onclick="listFiles()">Refresh List</button>
    <div id="fileList"></div>

    <div style="margin-top: 30px; overflow: auto;">
        <span id="modeLabel" style="font-size: 0.8em; color: #30363d;">Guest Mode</span>
        <button class="secret-btn" onclick="toggleLogin()">üîë</button>
    </div>

    <div id="adminLogin">
        <p style="font-size: 0.9em;">Enter Token to Enable Uploads:</p>
        <input type="password" id="tokenInput" placeholder="GitHub Personal Access Token">
        <button onclick="saveToken()" style="background: #30363d; color: white; border:1px solid #8b949e;">Unlock</button>
    </div>
</div>

<script>
    // ==========================================
    // ‚öôÔ∏è SETUP: EDIT THESE TWO LINES ONLY!
    // ==========================================
    const GITHUB_USERNAME = "replityash2";  
    const REPO_NAME = "apk-storage"; // Make sure this matches your PUBLIC storage repo name exactly
    // ==========================================

    let USER_TOKEN = localStorage.getItem('gh_token') || "";

    // On Load
    window.onload = function() {
        if (USER_TOKEN) {
            enableAdminMode();
        } else {
            document.getElementById('modeLabel').innerText = "Guest Mode (Read Only)";
        }
        listFiles();
    };

    function toggleLogin() {
        const loginDiv = document.getElementById('adminLogin');
        // If hidden, show it. If showing, hide it.
        if (loginDiv.style.display === "block") {
            loginDiv.style.display = "none";
        } else {
            loginDiv.style.display = "block";
        }
    }

    function saveToken() {
        const token = document.getElementById('tokenInput').value.trim();
        if (token) {
            localStorage.setItem('gh_token', token);
            USER_TOKEN = token;
            enableAdminMode();
            alert("Admin Mode Unlocked! üîì");
            toggleLogin(); // Hide the box
            listFiles(); // Refresh to show delete buttons
        }
    }

    function enableAdminMode() {
        document.querySelectorAll('.admin-controls').forEach(el => el.style.display = 'block');
        document.getElementById('modeLabel').innerText = "‚úÖ Admin Mode Active";
    }

    // --- CORE FUNCTIONS ---

    async function listFiles() {
        const listDiv = document.getElementById('fileList');
        listDiv.innerHTML = "<p style='text-align:center'>Loading...</p>";

        const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents`;
        // Note: We don't need a token to LIST files if the repo is Public
        const headers = USER_TOKEN ? { 'Authorization': `token ${USER_TOKEN}` } : {};

        try {
            const res = await fetch(url, { headers });
            if (!res.ok) throw new Error("Repo not found");
            const data = await res.json();
            
            listDiv.innerHTML = "";

            data.forEach(file => {
                if(file.type === "file") {
                    // Create Delete Button HTML (Only if Admin)
                    let deleteHtml = "";
                    if (USER_TOKEN) {
                        deleteHtml = `<button class="btn-delete" onclick="deleteFile('${file.path}', '${file.sha}')">Delete</button>`;
                    }

                    listDiv.innerHTML += `
                        <div class="file-item">
                            <a href="${file.download_url}" class="file-name" target="_blank">${file.name}</a>
                            <div style="display:flex; align-items:center;">
                                <span style="font-size:0.8em; color:#8b949e; margin-right:10px;">${(file.size/1024/1024).toFixed(2)} MB</span>
                                ${deleteHtml}
                            </div>
                        </div>
                    `;
                }
            });
            if (data.length === 0) listDiv.innerHTML = "<p style='text-align:center'>No files found.</p>";
        } catch (e) {
            listDiv.innerHTML = `<p style='text-align:center; color:#da3633'>Error: Could not find repo '${REPO_NAME}'</p>`;
        }
    }

    async function uploadFile() {
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('uploadStatus');
        if (!fileInput.files.length) return alert("Select a file first");

        const file = fileInput.files[0];
        status.innerText = "‚è≥ Uploading...";

        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = async function() {
            const content = reader.result.split(',')[1];
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${file.name}`;

            try {
                const res = await fetch(url, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${USER_TOKEN}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: "Upload", content: content })
                });
                if (res.ok) {
                    status.innerText = "‚úÖ Done!";
                    fileInput.value = "";
                    listFiles();
                } else {
                    const err = await res.json();
                    status.innerText = "‚ùå Error: " + err.message;
                }
            } catch (e) { status.innerText = "‚ùå Network Error"; }
        };
    }

    async function deleteFile(path, sha) {
        if(!confirm("Delete this file?")) return;
        const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/${path}`;
        await fetch(url, {
            method: 'DELETE',
            headers: { 'Authorization': `token ${USER_TOKEN}`, 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: "Delete", sha: sha })
        });
        listFiles();
    }
</script>

</body>
</html>
